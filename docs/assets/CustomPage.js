import{d as L,l as k,k as l,x as P,y as B,o as g,a as x,m as b,v as $,f as h,u as w,F as C,n as E,g as N,a5 as R,e as j,Z as H,M as T}from"./vendor.js";import{u as I}from"./useEmitter.js";import{u as W}from"./projectStore.js";import{B as U}from"./BodyBlock.js";import{_ as V}from"./PlaceholderBlock.vue_vue_type_script_setup_true_lang.js";import{u as D}from"./uiStore.js";import{M as O,m as A,p as Z,a as q,b as z,c as G,d as J,e as K,f as Q,g as X,i as Y,h as ee}from"./index2.js";import{W as te}from"./WaveLoading.js";import"./_plugin-vue_export-helper.js";const ae=(f,n)=>{const c=n-f,r=Math.random();return f+Math.round(r*c)},ne=["innerHTML"],se=L({__name:"MarkdownBlock",props:{source:null,i18n:{type:Boolean,default:!1},fallbackLocale:{default:"en"},finalFallbackFn:{type:Function,default:()=>{}},includeFileExtension:{type:Boolean,default:!0},fileExtension:{default:".md"}},setup(f){const n=f,c=I(),r=D(),_=new O({html:!0,xhtmlOut:!0,breaks:!0,linkify:!0,typographer:!0}).use(A).use(Z).use(q).use(z).use(G).use(J).use(K).use(Q).use(X).use(Y).use(ee),u=k(!0),s=k(!1),o=k(""),d=k(""),m=l(()=>n.i18n?`.${r.locale}`:""),t=l(()=>n.i18n?`.${n.fallbackLocale}`:""),a=l(()=>n.includeFileExtension?n.fileExtension:""),p=l(()=>o.value),S=l(()=>_.render(p.value)),M=async(i,e)=>{d.value=i,u.value=!0,s.value=!1;let y=!1;if(i.length===0)o.value="",u.value=!1,s.value=!1;else{!e||e.length===0?e=m.value:e.startsWith(".")||(e=`.${e}`);try{const v=await fetch(i+e+a.value);v.ok?(o.value=await v.text(),s.value=!0):(!e||e.length===0?e=t.value:e.startsWith(".")||(e=`.${e}`),(await fetch(i+e+a.value)).ok?(o.value=await v.text(),s.value=!0):(o.value="",s.value=!1,y=!0))}catch(v){!e||e.length===0?e=t.value:e.startsWith(".")||(e=`.${e}`);const F=await fetch(i+e+a.value);F.ok?(o.value=await F.text(),s.value=!0):(o.value="",s.value=!1,y=!0)}finally{u.value=!1,y&&n.finalFallbackFn()}}};return P(async()=>{c.on("toRerenderMarkdown",i=>{const e=i;M(e.source,e.locale)}),await M(n.source)}),B(()=>{c.off("toRerenderMarkdown")}),(i,e)=>(g(),x(C,null,[b(h(te,null,null,512),[[$,u.value]]),b((g(),x("div",{innerHTML:w(S),class:"markdown-body",key:d.value},null,8,ne)),[[$,!u.value]])],64))}}),oe={class:"xl:flex xlï¼šjustify-between"},re=j("div",{class:"xl:flex-none xl:w-72 xl:order-last"},null,-1),ue={key:0,class:"xl:flex-1"},he=L({__name:"CustomPage",setup(f){const n=T(),c=R(),r=I(),_=W(),u=ae(1,1e5),s=l(()=>{const t=n.params.customName,a=_.currentProjectProfile.modules;if(!a)return null;const p=a[t];return p||null}),o=l(()=>{const t=s.value;if(!t)return!1;const a=t.file;return a?a.length>0:!1}),d=l(()=>o.value?n.params.id+"/"+s.value.file:""),m=l(()=>{if(o.value){const t=s.value.scope;return!t||t.length===0?"projects":t}else return"projects"});return P(()=>{r.on("toChangeLocale",async t=>{const a=t;r.emit("toRerenderMarkdown",{source:`/content/${m.value}/${d.value}`,locale:a.locale})}),r.on(`toBind404Page${u}`,t=>{const a=t;c.push({path:`/projects/${a.akaId}/paper-not-found`})}),E(()=>{r.emit("toChangeProjectPaper",{paper:n.params.customName,broadcast:u})})}),B(()=>{r.off(`toBind404Page${u}`),r.off("toChangeLocale")}),(t,a)=>(g(),x(C,null,[h(U,{class:"content-paper markdown-toc-right"},{default:N(()=>[j("div",oe,[re,w(o)?(g(),x("div",ue,[h(se,{source:`/content/${w(m)}/${w(d)}`,i18n:!0,"fallback-locale":"en"},null,8,["source"])])):H("",!0)])]),_:1}),h(V,{height:"20px"})],64))}});export{he as default};
