import{d as S,l as i,k as u,x as E,y as $,o as h,a as p,m as g,v as y,f as C,u as T,F as W,a5 as B}from"./vendor.js";import{u as H}from"./useEmitter.js";import{u as j}from"./uiStore.js";import{M as O,m as U,p as A,a as D,b as N,c as R,d as V,e as q,f as z,g as G,i as J,h as K}from"./index2.js";import{W as P}from"./WaveLoading.js";const Q=["innerHTML"],ae=S({__name:"MarkdownWorker",props:{source:null,i18n:{type:Boolean,default:!1},fallbackLocale:{default:"en"},finalFallbackFn:{type:Function,default:()=>{}},includeFileExtension:{type:Boolean,default:!0},fileExtension:{default:".md"},redirectTo404:{type:Boolean,default:!1}},setup(F){const t=F,x=B(),m=H(),b=j(),L=new O({html:!0,xhtmlOut:!0,breaks:!0,linkify:!0,typographer:!0}).use(U).use(A).use(D).use(N).use(R).use(V).use(q).use(z).use(G).use(J).use(K),r=i(!0),a=i(!1),n=i(""),v=i(""),M=u(()=>t.i18n?`.${b.locale}`:""),k=u(()=>t.i18n?`.${t.fallbackLocale}`:""),l=u(()=>t.includeFileExtension?t.fileExtension:""),_=u(()=>n.value),I=u(()=>L.render(_.value)),w=async(s,e)=>{v.value=s,r.value=!0,a.value=!1;let f=!1;if(s.length===0)n.value="",r.value=!1,a.value=!1;else{!e||e.length===0?e=M.value:e.startsWith(".")||(e=`.${e}`);const c=`/content/${s}`;try{const o=await fetch(c+e+l.value);o.ok?(n.value=await o.text(),a.value=!0):(!e||e.length===0?e=k.value:e.startsWith(".")||(e=`.${e}`),(await fetch(c+e+l.value)).ok?(n.value=await o.text(),a.value=!0):(n.value="",a.value=!1,f=!0))}catch(o){!e||e.length===0?e=k.value:e.startsWith(".")||(e=`.${e}`);const d=await fetch(c+e+l.value);d.ok?(n.value=await d.text(),a.value=!0):(n.value="",a.value=!1,f=!0)}finally{r.value=!1,f&&(t.finalFallbackFn(),t.redirectTo404&&await x.replace("/404"))}}};return E(async()=>{m.on("toChangeLocale",async s=>{if(!t.i18n)return;const e=s;await w(t.source,e.locale)}),await w(t.source)}),$(()=>{m.off("toChangeLocale")}),(s,e)=>(h(),p(W,null,[g(C(P,null,null,512),[[y,r.value]]),g((h(),p("div",{innerHTML:T(I),class:"markdown-body",key:v.value},null,8,Q)),[[y,!r.value]])],64))}});export{ae as _};
